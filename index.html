<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ìú¥Í∞Ä Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ============================================
        // ÏÑ§Ï†ï
        // ============================================
        
        // Google Apps Script Ïõπ Ïï± URL
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzTQVLsxOpoeFMejhAu-I6OJm8idXiER2SDCrIesrVVTidkSeI5SV0hjHUMuo_7JNnQ/exec';
        
        // Google Calendar ID
        const CALENDAR_ID = 'c_5dd7e193b8547b937f07d753f828f11e74003961a6d30b2daf22243d7ba0afac@group.calendar.google.com';
        
        // Google OAuth Client ID (Ïó¨Í∏∞Ïóê Î∞úÍ∏âÎ∞õÏùÄ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ID ÏûÖÎ†•)
        const GOOGLE_CLIENT_ID = '515092066469-v0lkn16jt7m8p8e3tqak7mo8s5irvto4.apps.googleusercontent.com';
        const GOOGLE_API_KEY = 'AIzaSyDj6uiKHHHHZ1Z8EE2TxRq2o00LN6LAvvo';

        // ============================================
        // Google Sheets API Ìï®ÏàòÎì§
        // ============================================
        
        const callAppsScript = async (action, params = {}) => {
            try {
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ action, ...params })
                });
                
                // no-cors Î™®ÎìúÏóêÏÑúÎäî ÏùëÎãµÏùÑ ÏùΩÏùÑ Ïàò ÏóÜÏúºÎØÄÎ°ú ÏûÑÏãú Î∞©Î≤ï ÏÇ¨Ïö©
                // Ïã§Ï†úÎ°úÎäî ÏÑ±Í≥µÌñàÎã§Í≥† Í∞ÄÏ†ï
                return { success: true };
            } catch (error) {
                console.error('Apps Script Ìò∏Ï∂ú Ïò§Î•ò:', error);
                return { success: false, error: error.toString() };
            }
        };

        // Google SheetsÏóêÏÑú ÏÇ¨Ïö©Ïûê Í∞ÄÏ†∏Ïò§Í∏∞
        const getUserFromSheet = async (email) => {
            try {
                const response = await fetch(`${APPS_SCRIPT_URL}?action=getUser&email=${encodeURIComponent(email)}`);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('ÏÇ¨Ïö©Ïûê Ï°∞Ìöå Ïò§Î•ò:', error);
                return null;
            }
        };

        // ============================================
        // Google Calendar API
        // ============================================
        
        let gapiInited = false;
        let gisInited = false;
        let tokenClient;

        const initClient = () => {
            return new Promise((resolve, reject) => {
                // Client IDÍ∞Ä ÏÑ§Ï†ïÎêòÏñ¥ ÏûàÏúºÎ©¥ Í≥ÑÏÜç ÏßÑÌñâ
                
                gapi.load('client', async () => {
                    try {
                        await gapi.client.init({
                            apiKey: GOOGLE_API_KEY,
                            discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],
                        });
                        gapiInited = true;
                        resolve();
                    } catch (error) {
                        console.error('GAPI Ï¥àÍ∏∞Ìôî Ïã§Ìå®:', error);
                        reject(error);
                    }
                });
            });
        };

        const initGIS = () => {
            return new Promise((resolve) => {
                // Client IDÍ∞Ä ÏÑ§Ï†ïÎêòÏñ¥ ÏûàÏúºÎ©¥ Í≥ÑÏÜç ÏßÑÌñâ
                
                if (typeof google !== 'undefined' && google.accounts) {
                    tokenClient = google.accounts.oauth2.initTokenClient({
                        client_id: GOOGLE_CLIENT_ID,
                        scope: 'https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/userinfo.email',
                        callback: '',
                    });
                    gisInited = true;
                    resolve();
                } else {
                    setTimeout(() => {
                        initGIS().then(resolve);
                    }, 100);
                }
            });
        };

        const handleAuthClick = () => {
            return new Promise((resolve, reject) => {
                tokenClient.callback = async (resp) => {
                    if (resp.error !== undefined) {
                        reject(resp);
                    } else {
                        resolve(resp);
                    }
                };

                if (gapi.client.getToken() === null) {
                    tokenClient.requestAccessToken({ prompt: 'consent' });
                } else {
                    tokenClient.requestAccessToken({ prompt: '' });
                }
            });
        };

        const isSignedIn = () => {
            return gapi.client.getToken() !== null;
        };

        const signOut = () => {
            const token = gapi.client.getToken();
            if (token !== null) {
                google.accounts.oauth2.revoke(token.access_token);
                gapi.client.setToken('');
            }
        };

        const getCurrentUserEmail = async () => {
            try {
                const response = await gapi.client.request({
                    path: 'https://www.googleapis.com/oauth2/v2/userinfo',
                });
                return response.result.email;
            } catch (error) {
                console.error('Ïù¥Î©îÏùº Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìå®:', error);
                return null;
            }
        };

        const createVacationEvent = async (userName, vacationType, startDate, endDate = null) => {
            try {
                const eventEndDate = endDate || startDate;
                const adjustedEndDate = new Date(eventEndDate);
                adjustedEndDate.setDate(adjustedEndDate.getDate() + 1);
                const formattedEndDate = adjustedEndDate.toISOString().split('T')[0];
                
                const event = {
                    summary: `${userName} - ${vacationType}`,
                    description: `${userName}ÎãòÏùò ${vacationType}`,
                    start: {
                        date: startDate,
                        timeZone: 'Asia/Seoul',
                    },
                    end: {
                        date: formattedEndDate,
                        timeZone: 'Asia/Seoul',
                    },
                    colorId: vacationType === 'Ïó∞Ï∞®' ? '9' : vacationType === 'Ïò§Ï†ÑÎ∞òÏ∞®' ? '10' : '11',
                };

                const response = await gapi.client.calendar.events.insert({
                    calendarId: CALENDAR_ID,
                    resource: event,
                });
                
                return response.result;
            } catch (error) {
                console.error('Ï∫òÎ¶∞Îçî Ïù¥Î≤§Ìä∏ ÏÉùÏÑ± Ïã§Ìå®:', error);
                throw error;
            }
        };

        const deleteVacationEvent = async (eventId) => {
            try {
                await gapi.client.calendar.events.delete({
                    calendarId: CALENDAR_ID,
                    eventId: eventId,
                });
            } catch (error) {
                console.error('Ï∫òÎ¶∞Îçî Ïù¥Î≤§Ìä∏ ÏÇ≠Ï†ú Ïã§Ìå®:', error);
                throw error;
            }
        };

        const getCalendarWebLink = () => {
            return `https://calendar.google.com/calendar/embed?src=${encodeURIComponent(CALENDAR_ID)}`;
        };

        // ============================================
        // ÏïÑÏù¥ÏΩò Ïª¥Ìè¨ÎÑåÌä∏Îì§
        // ============================================
        
        const CalendarIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const LogOutIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
        );

        const SettingsIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6"></path>
            </svg>
        );

        const PlusIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const TrashIcon = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
        );

        const LinkIcon = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
            </svg>
        );

        // ============================================
        // Î©îÏù∏ Ïª¥Ìè¨ÎÑåÌä∏
        // ============================================

        const VacationSystem = () => {
            const [currentUser, setCurrentUser] = useState(null);
            const [allUsers, setAllUsers] = useState([]);
            const [vacations, setVacations] = useState([]);
            const [showLogin, setShowLogin] = useState(true);
            const [showAdminPanel, setShowAdminPanel] = useState(false);
            const [showVacationForm, setShowVacationForm] = useState(false);
            const [loading, setLoading] = useState(false);
            
            const [isGoogleSignedIn, setIsGoogleSignedIn] = useState(false);
            const [isGoogleInitialized, setIsGoogleInitialized] = useState(false);

            const [vacationType, setVacationType] = useState('Ïó∞Ï∞®');
            const [vacationDate, setVacationDate] = useState('');
            const [vacationStartDate, setVacationStartDate] = useState('');
            const [vacationEndDate, setVacationEndDate] = useState('');
            
            const [selectedUserForAdmin, setSelectedUserForAdmin] = useState('');
            const [vacationDaysToSet, setVacationDaysToSet] = useState(8);

            // Ï¥àÍ∏∞Ìôî
            useEffect(() => {
                // Google API Ï¥àÍ∏∞Ìôî
                if (GOOGLE_CLIENT_ID !== 'YOUR_CLIENT_ID_HERE.apps.googleusercontent.com') {
                    Promise.all([initClient(), initGIS()]).then(() => {
                        setIsGoogleInitialized(true);
                        setIsGoogleSignedIn(isSignedIn());
                    }).catch(console.error);
                }

                // localStorageÏóêÏÑú Ìú¥Í∞Ä Îç∞Ïù¥ÌÑ∞ Î°úÎìú (ÏûÑÏãú Ï∫êÏãú)
                const cachedVacations = JSON.parse(localStorage.getItem('vacations') || '[]');
                setVacations(cachedVacations);
            }, []);

            // Google Î°úÍ∑∏Ïù∏
            const handleGoogleSignIn = async () => {
                try {
                    setLoading(true);
                    await handleAuthClick();
                    setIsGoogleSignedIn(true);
                    
                    // Ïù¥Î©îÏùº Í∞ÄÏ†∏Ïò§Í∏∞
                    const email = await getCurrentUserEmail();
                    
                    if (!email) {
                        alert('Ïù¥Î©îÏùºÏùÑ Í∞ÄÏ†∏Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
                        setLoading(false);
                        return;
                    }

                    // Google SheetsÏóêÏÑú ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
                    // ÏûÑÏãúÎ°ú localStorage ÏÇ¨Ïö© (no-cors Î¨∏Ï†ú)
                    const userData = localStorage.getItem('userData_' + email);
                    
                    if (userData) {
                        const user = JSON.parse(userData);
                        setCurrentUser(user);
                        setShowLogin(false);
                        loadVacations();
                    } else {
                        // Ï≤´ Î°úÍ∑∏Ïù∏ - Í¥ÄÎ¶¨ÏûêÏóêÍ≤å Îì±Î°ù ÏöîÏ≤≠
                        alert(`${email} Í≥ÑÏ†ïÏù¥ Îì±Î°ùÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.\nÍ¥ÄÎ¶¨ÏûêÏóêÍ≤å Google SheetsÏóê Í≥ÑÏ†ï Ï∂îÍ∞ÄÎ•º ÏöîÏ≤≠ÌïòÏÑ∏Ïöî.`);
                        signOut();
                        setIsGoogleSignedIn(false);
                    }
                    
                    setLoading(false);
                } catch (error) {
                    console.error('Google Î°úÍ∑∏Ïù∏ Ïã§Ìå®:', error);
                    alert('Google Î°úÍ∑∏Ïù∏Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                    setLoading(false);
                }
            };

            // Îç∞Î™®Ïö©: ÏàòÎèô ÏÇ¨Ïö©Ïûê Îì±Î°ù (Google Sheets Ïó∞Îèô Ï†Ñ)
            const registerDemoUser = (email, name) => {
                const user = {
                    email: email,
                    name: name,
                    totalVacationDays: 15,
                    isAdmin: true,
                    canEdit: true
                };
                localStorage.setItem('userData_' + email, JSON.stringify(user));
                alert(`${name}ÎãòÏù¥ Îì±Î°ùÎêòÏóàÏäµÎãàÎã§! Îã§Ïãú Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî.`);
            };

            const handleGoogleSignOut = () => {
                signOut();
                setIsGoogleSignedIn(false);
                setCurrentUser(null);
                setShowLogin(true);
                setShowAdminPanel(false);
                setShowVacationForm(false);
            };

            const loadVacations = () => {
                const cached = JSON.parse(localStorage.getItem('vacations') || '[]');
                setVacations(cached);
            };

            const saveVacations = (updatedVacations) => {
                setVacations(updatedVacations);
                localStorage.setItem('vacations', JSON.stringify(updatedVacations));
                
                // Google SheetsÏóêÎèÑ Ï†ÄÏû• ÏãúÎèÑ
                // (no-cors Î¨∏Ï†úÎ°ú ÏùëÎãµÏùÄ Î∞õÏùÑ Ïàò ÏóÜÏßÄÎßå Î∞±Í∑∏ÎùºÏö¥ÎìúÏóêÏÑú Ï†ÄÏû•Îê®)
            };

            const getUsedVacationDays = (userEmail) => {
                return vacations
                    .filter(v => v.userId === userEmail)
                    .reduce((sum, v) => {
                        if (v.type === 'Ïó∞Ï∞®') return sum + 1;
                        if (v.type === 'Ïò§Ï†ÑÎ∞òÏ∞®' || v.type === 'Ïò§ÌõÑÎ∞òÏ∞®') return sum + 0.5;
                        return sum;
                    }, 0);
            };

            const calculateDaysBetween = (startDate, endDate) => {
                const start = new Date(startDate);
                const end = new Date(endDate);
                const diffTime = Math.abs(end - start);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                return diffDays;
            };

            const getDateRange = (startDate, endDate) => {
                const dates = [];
                const currentDate = new Date(startDate);
                const end = new Date(endDate);
                
                while (currentDate <= end) {
                    dates.push(new Date(currentDate).toISOString().split('T')[0]);
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                
                return dates;
            };

            const handleVacationRequest = async (e) => {
                e.preventDefault();
                
                const usedDays = getUsedVacationDays(currentUser.email);
                let requestDays = 0;
                let datesToAdd = [];

                if (vacationType === 'Ïó∞Ï∞®') {
                    if (!vacationStartDate || !vacationEndDate) {
                        alert('ÏãúÏûë ÎÇ†ÏßúÏôÄ Ï¢ÖÎ£å ÎÇ†ÏßúÎ•º Î™®Îëê ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                        return;
                    }

                    if (new Date(vacationStartDate) > new Date(vacationEndDate)) {
                        alert('Ï¢ÖÎ£å ÎÇ†ÏßúÎäî ÏãúÏûë ÎÇ†ÏßúÎ≥¥Îã§ Ïù¥ÌõÑÏó¨Ïïº Ìï©ÎãàÎã§.');
                        return;
                    }

                    requestDays = calculateDaysBetween(vacationStartDate, vacationEndDate);
                    datesToAdd = getDateRange(vacationStartDate, vacationEndDate);
                } else {
                    if (!vacationDate) {
                        alert('ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                        return;
                    }
                    requestDays = 0.5;
                    datesToAdd = [vacationDate];
                }
                
                if (usedDays + requestDays > currentUser.totalVacationDays) {
                    alert('Ìú¥Í∞ÄÎ•º Î™®Îëê ÏÇ¨Ïö©ÌïòÏÖ®ÏäµÎãàÎã§.');
                    return;
                }

                for (const date of datesToAdd) {
                    const existingVacation = vacations.find(v => 
                        v.userId === currentUser.email && 
                        v.date === date &&
                        (v.type === 'Ïó∞Ï∞®' || (v.type === vacationType && vacationType !== 'Ïó∞Ï∞®'))
                    );

                    if (existingVacation) {
                        alert(`${date} ÎÇ†ÏßúÏóê Ïù¥ÎØ∏ Ìú¥Í∞ÄÍ∞Ä Ïã†Ï≤≠ÎêòÏñ¥ ÏûàÏäµÎãàÎã§.`);
                        return;
                    }
                }

                try {
                    setLoading(true);
                    let googleEventId = null;

                    // Google CalendarÏóê Ïù¥Î≤§Ìä∏ ÏÉùÏÑ±
                    if (isGoogleSignedIn && gapiInited) {
                        try {
                            if (vacationType === 'Ïó∞Ï∞®') {
                                const event = await createVacationEvent(
                                    currentUser.name,
                                    vacationType,
                                    vacationStartDate,
                                    vacationEndDate
                                );
                                googleEventId = event.id;
                            } else {
                                const event = await createVacationEvent(
                                    currentUser.name,
                                    vacationType,
                                    vacationDate,
                                    vacationDate
                                );
                                googleEventId = event.id;
                            }
                        } catch (error) {
                            console.error('Google Calendar Ïó∞Îèô Ïã§Ìå®:', error);
                        }
                    }

                    // Ìú¥Í∞Ä Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
                    const newVacations = datesToAdd.map((date, index) => ({
                        id: `vac-${Date.now()}-${index}`,
                        userId: currentUser.email,
                        userName: currentUser.name,
                        type: vacationType,
                        date: date,
                        startDate: vacationType === 'Ïó∞Ï∞®' ? vacationStartDate : null,
                        endDate: vacationType === 'Ïó∞Ï∞®' ? vacationEndDate : null,
                        isRangeVacation: vacationType === 'Ïó∞Ï∞®' && datesToAdd.length > 1,
                        googleEventId: googleEventId,
                        createdAt: new Date().toISOString()
                    }));

                    const updatedVacations = [...vacations, ...newVacations];
                    saveVacations(updatedVacations);

                    // Google SheetsÏóê Ï†ÄÏû•
                    for (const vacation of newVacations) {
                        await callAppsScript('addVacation', { vacation });
                    }
                    
                    const syncMessage = googleEventId 
                        ? ' (Google CalendarÏóê ÎèôÍ∏∞ÌôîÎê®)' 
                        : '';
                    alert(`Ìú¥Í∞Ä Ïã†Ï≤≠Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§! (${requestDays}Ïùº ÏÇ¨Ïö©)${syncMessage}`);
                    
                    setShowVacationForm(false);
                    setVacationDate('');
                    setVacationStartDate('');
                    setVacationEndDate('');
                    setVacationType('Ïó∞Ï∞®');
                    setLoading(false);

                } catch (error) {
                    console.error('Ìú¥Í∞Ä Ïã†Ï≤≠ Ïò§Î•ò:', error);
                    alert('Ìú¥Í∞Ä Ïã†Ï≤≠ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                    setLoading(false);
                }
            };

            const handleDeleteVacation = async (vacationId) => {
                if (!currentUser.isAdmin && !currentUser.canEdit) {
                    alert('Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.');
                    return;
                }

                const vacation = vacations.find(v => v.id === vacationId);
                
                if (window.confirm('Ïù¥ Ìú¥Í∞ÄÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    try {
                        // Google CalendarÏóêÏÑú ÏÇ≠Ï†ú
                        if (vacation.googleEventId && isGoogleSignedIn) {
                            try {
                                await deleteVacationEvent(vacation.googleEventId);
                            } catch (error) {
                                console.error('Google Calendar ÏÇ≠Ï†ú Ïã§Ìå®:', error);
                            }
                        }
                        
                        // Î°úÏª¨ÏóêÏÑú ÏÇ≠Ï†ú
                        const updatedVacations = vacations.filter(v => v.id !== vacationId);
                        saveVacations(updatedVacations);

                        // Google SheetsÏóêÏÑú ÏÇ≠Ï†ú
                        await callAppsScript('deleteVacation', { vacationId });
                        
                        alert('Ìú¥Í∞ÄÍ∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                    } catch (error) {
                        console.error('ÏÇ≠Ï†ú Ïò§Î•ò:', error);
                        alert('ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                    }
                }
            };

            // Î°úÍ∑∏Ïù∏ ÌôîÎ©¥
            if (showLogin) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
                            <div className="text-center mb-8">
                                <div className="w-16 h-16 mx-auto text-indigo-600 mb-4">
                                    <CalendarIcon />
                                </div>
                                <h1 className="text-3xl font-bold text-gray-800 mb-2">Ìú¥Í∞Ä Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</h1>
                                <p className="text-gray-600">Google Í≥ÑÏ†ïÏúºÎ°ú Î°úÍ∑∏Ïù∏ÌïòÏÑ∏Ïöî</p>
                            </div>

                            {isGoogleInitialized ? (
                                <div className="space-y-4">
                                    <button
                                        onClick={handleGoogleSignIn}
                                        disabled={loading}
                                        className="w-full bg-white border-2 border-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-50 transition flex items-center justify-center space-x-2"
                                    >
                                        {loading ? (
                                            <span>Î°úÍ∑∏Ïù∏ Ï§ë...</span>
                                        ) : (
                                            <>
                                                <svg className="w-5 h-5" viewBox="0 0 24 24">
                                                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                                                </svg>
                                                <span>Google Í≥ÑÏ†ïÏúºÎ°ú Î°úÍ∑∏Ïù∏</span>
                                            </>
                                        )}
                                    </button>

                                    <div className="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                        <p className="text-sm text-blue-800">
                                            <strong>Ï≤òÏùå ÏÇ¨Ïö©ÌïòÏãúÎÇòÏöî?</strong><br />
                                            Í¥ÄÎ¶¨ÏûêÍ∞Ä Google SheetsÏóê Í≥ÑÏ†ïÏùÑ Ï∂îÍ∞ÄÌïú ÌõÑ Î°úÍ∑∏Ïù∏ÌïòÏÑ∏Ïöî.
                                        </p>
                                    </div>

                                    {/* Îç∞Î™®Ïö© Í≥ÑÏ†ï Îì±Î°ù Î≤ÑÌäº */}
                                    <button
                                        onClick={() => {
                                            const email = prompt('Îì±Î°ùÌï† Ïù¥Î©îÏùºÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
                                            const name = prompt('Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
                                            if (email && name) {
                                                registerDemoUser(email, name);
                                            }
                                        }}
                                        className="w-full bg-gray-100 text-gray-600 py-2 rounded-lg text-sm hover:bg-gray-200 transition"
                                    >
                                        ÌÖåÏä§Ìä∏Ïö©: ÏàòÎèô Í≥ÑÏ†ï Îì±Î°ù
                                    </button>
                                </div>
                            ) : (
                                <div className="text-center">
                                    <p className="text-gray-600">Google API Ï¥àÍ∏∞Ìôî Ï§ë...</p>
                                    <div className="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                                        <p className="text-sm text-yellow-800">
                                            <strong>ÏÑ§Ï†ïÏù¥ ÌïÑÏöîÌï©ÎãàÎã§:</strong><br />
                                            HTML ÌååÏùºÏóêÏÑú GOOGLE_CLIENT_IDÏôÄ GOOGLE_API_KEYÎ•º ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.
                                        </p>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            // Î©îÏù∏ ÌôîÎ©¥
            const usedDays = getUsedVacationDays(currentUser.email);
            const remainingDays = currentUser.totalVacationDays - usedDays;

            return (
                <div className="min-h-screen bg-gray-100">
                    {/* Ìó§Îçî */}
                    <div className="bg-white shadow-md">
                        <div className="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
                            <div className="flex items-center space-x-3">
                                <div className="w-8 h-8 text-indigo-600">
                                    <CalendarIcon />
                                </div>
                                <div>
                                    <h1 className="text-2xl font-bold text-gray-800">Ìú¥Í∞Ä Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</h1>
                                    <p className="text-sm text-gray-600">{currentUser.name}Îãò ({currentUser.email})</p>
                                </div>
                            </div>
                            
                            <div className="flex items-center space-x-3">
                                {currentUser.isAdmin && (
                                    <button
                                        onClick={() => {
                                            setShowAdminPanel(!showAdminPanel);
                                            setShowVacationForm(false);
                                        }}
                                        className="flex items-center space-x-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition"
                                    >
                                        <SettingsIcon />
                                        <span>Í¥ÄÎ¶¨Ïûê</span>
                                    </button>
                                )}
                                
                                <button
                                    onClick={handleGoogleSignOut}
                                    className="flex items-center space-x-2 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition"
                                >
                                    <LogOutIcon />
                                    <span>Î°úÍ∑∏ÏïÑÏõÉ</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-4 py-8 space-y-6">
                        {/* Ìú¥Í∞Ä ÌòÑÌô© */}
                        <div className="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg shadow-lg p-6 text-white">
                            <h2 className="text-2xl font-bold mb-4">ÎÇ¥ Ìú¥Í∞Ä ÌòÑÌô©</h2>
                            <div className="grid grid-cols-3 gap-4">
                                <div className="bg-white bg-opacity-20 rounded-lg p-4">
                                    <p className="text-sm opacity-90">Ï¥ù Ìú¥Í∞Ä</p>
                                    <p className="text-3xl font-bold">{currentUser.totalVacationDays}Ïùº</p>
                                </div>
                                <div className="bg-white bg-opacity-20 rounded-lg p-4">
                                    <p className="text-sm opacity-90">ÏÇ¨Ïö©Ìïú Ìú¥Í∞Ä</p>
                                    <p className="text-3xl font-bold">{usedDays}Ïùº</p>
                                </div>
                                <div className="bg-white bg-opacity-20 rounded-lg p-4">
                                    <p className="text-sm opacity-90">ÎÇ®ÏùÄ Ìú¥Í∞Ä</p>
                                    <p className="text-3xl font-bold">{remainingDays}Ïùº</p>
                                </div>
                            </div>
                        </div>

                        {/* Ìú¥Í∞Ä Ïã†Ï≤≠ Î≤ÑÌäº */}
                        {!showAdminPanel && !showVacationForm && (
                            <button
                                onClick={() => setShowVacationForm(true)}
                                className="w-full bg-indigo-600 text-white py-4 rounded-lg font-semibold hover:bg-indigo-700 transition flex items-center justify-center space-x-2"
                            >
                                <PlusIcon />
                                <span>ÏÉà Ìú¥Í∞Ä Ïã†Ï≤≠</span>
                            </button>
                        )}

                        {/* Ìú¥Í∞Ä Ïã†Ï≤≠ Ìèº */}
                        {showVacationForm && (
                            <div className="bg-white rounded-lg shadow-md p-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-4">Ìú¥Í∞Ä Ïã†Ï≤≠</h2>
                                <form onSubmit={handleVacationRequest} className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Ìú¥Í∞Ä Ï¢ÖÎ•ò</label>
                                        <select
                                            value={vacationType}
                                            onChange={(e) => setVacationType(e.target.value)}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                        >
                                            <option value="Ïó∞Ï∞®">Ïó∞Ï∞® (1Ïùº)</option>
                                            <option value="Ïò§Ï†ÑÎ∞òÏ∞®">Ïò§Ï†ÑÎ∞òÏ∞® (0.5Ïùº)</option>
                                            <option value="Ïò§ÌõÑÎ∞òÏ∞®">Ïò§ÌõÑÎ∞òÏ∞® (0.5Ïùº)</option>
                                        </select>
                                    </div>

                                    {vacationType === 'Ïó∞Ï∞®' ? (
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">ÏãúÏûë ÎÇ†Ïßú</label>
                                                <input
                                                    type="date"
                                                    value={vacationStartDate}
                                                    onChange={(e) => setVacationStartDate(e.target.value)}
                                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                                    required
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Ï¢ÖÎ£å ÎÇ†Ïßú</label>
                                                <input
                                                    type="date"
                                                    value={vacationEndDate}
                                                    onChange={(e) => setVacationEndDate(e.target.value)}
                                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                                    required
                                                />
                                            </div>
                                        </div>
                                    ) : (
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">ÎÇ†Ïßú</label>
                                            <input
                                                type="date"
                                                value={vacationDate}
                                                onChange={(e) => setVacationDate(e.target.value)}
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                                required
                                            />
                                        </div>
                                    )}
                                    
                                    <div className="flex gap-3">
                                        <button
                                            type="submit"
                                            disabled={loading}
                                            className="flex-1 bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition disabled:bg-gray-400"
                                        >
                                            {loading ? 'Ï≤òÎ¶¨ Ï§ë...' : 'Ïã†Ï≤≠ÌïòÍ∏∞'}
                                        </button>
                                        <button
                                            type="button"
                                            onClick={() => {
                                                setShowVacationForm(false);
                                                setVacationDate('');
                                                setVacationStartDate('');
                                                setVacationEndDate('');
                                            }}
                                            className="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg hover:bg-gray-300 transition"
                                        >
                                            Ï∑®ÏÜå
                                        </button>
                                    </div>
                                </form>
                            </div>
                        )}

                        {/* Google Calendar ÎßÅÌÅ¨ */}
                        {isGoogleInitialized && (
                            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <h3 className="font-semibold text-blue-900 mb-1">üìÖ Í≥µÏö© Google Calendar</h3>
                                        <p className="text-sm text-blue-800">ÌåÄÏõêÎì§Ïùò Ìú¥Í∞Ä ÏùºÏ†ïÏùÑ Google CalendarÏóêÏÑú ÌôïÏù∏ÌïòÏÑ∏Ïöî</p>
                                    </div>
                                    <a
                                        href={getCalendarWebLink()}
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        className="flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
                                    >
                                        <LinkIcon />
                                        <span>Ï∫òÎ¶∞Îçî Ïó¥Í∏∞</span>
                                    </a>
                                </div>
                            </div>
                        )}

                        {/* Ï†ÑÏ≤¥ Ìú¥Í∞Ä ÏùºÏ†ï */}
                        <div className="bg-white rounded-lg shadow-md p-6">
                            <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center">
                                <div className="w-5 h-5 mr-2"><CalendarIcon /></div>
                                Ï†ÑÏ≤¥ Ìú¥Í∞Ä ÏùºÏ†ï
                            </h2>
                            
                            {vacations.length === 0 ? (
                                <p className="text-gray-500 text-center py-8">Îì±Î°ùÎêú Ìú¥Í∞ÄÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>
                            ) : (
                                <div className="space-y-2">
                                    {vacations
                                        .sort((a, b) => new Date(a.date) - new Date(b.date))
                                        .filter((vacation, index, self) => {
                                            if (vacation.isRangeVacation) {
                                                return self.findIndex(v => 
                                                    v.userId === vacation.userId && 
                                                    v.startDate === vacation.startDate && 
                                                    v.endDate === vacation.endDate
                                                ) === index;
                                            }
                                            return true;
                                        })
                                        .map(vacation => {
                                            const typeColor = 
                                                vacation.type === 'Ïó∞Ï∞®' ? 'bg-blue-100 text-blue-800' :
                                                vacation.type === 'Ïò§Ï†ÑÎ∞òÏ∞®' ? 'bg-green-100 text-green-800' :
                                                'bg-purple-100 text-purple-800';
                                            
                                            let dateDisplay = '';
                                            if (vacation.isRangeVacation && vacation.startDate && vacation.endDate) {
                                                const startDate = new Date(vacation.startDate);
                                                const endDate = new Date(vacation.endDate);
                                                dateDisplay = `${startDate.getFullYear()}ÎÖÑ ${startDate.getMonth() + 1}Ïõî ${startDate.getDate()}Ïùº ~ ${endDate.getMonth() + 1}Ïõî ${endDate.getDate()}Ïùº (${calculateDaysBetween(vacation.startDate, vacation.endDate)}Ïùº)`;
                                            } else {
                                                const vacDate = new Date(vacation.date);
                                                dateDisplay = `${vacDate.getFullYear()}ÎÖÑ ${vacDate.getMonth() + 1}Ïõî ${vacDate.getDate()}Ïùº`;
                                            }
                                            
                                            return (
                                                <div key={vacation.id} className="flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
                                                    <div className="flex items-center space-x-4">
                                                        <div className="flex-shrink-0" style={{minWidth: '280px'}}>
                                                            <p className="text-sm font-medium text-gray-900">{dateDisplay}</p>
                                                        </div>
                                                        <span className={`px-3 py-1 rounded-full text-sm font-medium ${typeColor}`}>
                                                            {vacation.type}
                                                        </span>
                                                        <p className="text-gray-700 font-medium">{vacation.userName}</p>
                                                        {vacation.googleEventId && (
                                                            <span className="text-xs text-green-600">üìÖ</span>
                                                        )}
                                                    </div>
                                                    {(currentUser.isAdmin || currentUser.canEdit) && (
                                                        <button
                                                            onClick={() => handleDeleteVacation(vacation.id)}
                                                            className="text-red-600 hover:text-red-800 transition p-2"
                                                            title="ÏÇ≠Ï†ú"
                                                        >
                                                            <TrashIcon />
                                                        </button>
                                                    )}
                                                </div>
                                            );
                                        })}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // Î†åÎçîÎßÅ
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<VacationSystem />);
    </script>

    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</body>
</html>
